<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>yarn@berry | linrz</title>
    <meta name="description" content="">
    
    
    <link rel="preload" href="/assets/css/0.styles.08bdfdef.css" as="style"><link rel="preload" href="/assets/js/app.f896f474.js" as="script"><link rel="preload" href="/assets/js/3.44ff7866.js" as="script"><link rel="preload" href="/assets/js/1.cd6517b5.js" as="script"><link rel="preload" href="/assets/js/8.000ad2a2.js" as="script"><link rel="preload" href="/assets/js/5.5d81cbfa.js" as="script"><link rel="prefetch" href="/assets/js/10.69c42d1a.js"><link rel="prefetch" href="/assets/js/11.c078216b.js"><link rel="prefetch" href="/assets/js/12.d9dcbd39.js"><link rel="prefetch" href="/assets/js/13.c5c5db96.js"><link rel="prefetch" href="/assets/js/14.13bc983c.js"><link rel="prefetch" href="/assets/js/15.d0895eff.js"><link rel="prefetch" href="/assets/js/16.c55bc43d.js"><link rel="prefetch" href="/assets/js/17.69773d0e.js"><link rel="prefetch" href="/assets/js/18.ce78b8fa.js"><link rel="prefetch" href="/assets/js/4.3cf70c88.js"><link rel="prefetch" href="/assets/js/6.859179a3.js"><link rel="prefetch" href="/assets/js/7.4a666cf5.js"><link rel="prefetch" href="/assets/js/9.62d02a8d.js">
    <link rel="stylesheet" href="/assets/css/0.styles.08bdfdef.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div><div class="cute-nav"><div class="cute-nav-left"><a href="/">linrz</a></div> <div class="cute-nav-right"><div class="cute-nav-item cute-nav-active"><a href="/">Blog</a></div><div class="cute-nav-item "><a href="/about.html">About</a></div></div></div> <div class="cute-content"><div class="cute-page-header"><div class="cute-page-title">yarn@berry</div> <div class="cute-page-subtitle"><span class="cute-page-date">03/21 2019</span> <span>☕️</span> <span>4 min read</span></div></div> <div class="cute-page-markdown"><div slot="default" class="markdown-body content default"><p>Node.js 生态中，最喜欢的包管理器还是 yarn 了，yarn 的核心开发者 arcanis 在一月份时提出了对 yarn 文来的展望，有一些很有意思的 Feature，可以窥见 yarn 的野心。</p> <h2 id="plugin-system"><a href="#plugin-system" class="header-anchor">#</a> Plugin system</h2> <p>yarn 会提供插件化的系统支持，在 resolution/fetch/link 等步骤中可以运行插件的业务逻辑，举个栗子，<code>yarn@berry</code> 内置的 <a href="https://github.com/yarnpkg/berry/tree/master/packages/plugin-github" target="_blank" rel="noopener noreferrer">plugin-github<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> 支持 github 的地址，类似 <code>https://github.com/${username}/${reponame}/archive/${branch}.tar.gz</code> 作为依赖，当然也支持任意的 url，plugin-http 会帮我们完成依赖的下载安装解析等步骤。</p> <h2 id="cli"><a href="#cli" class="header-anchor">#</a> CLI</h2> <p>由于上文提到的插件化，yarn 不在是一个单纯的包管理器，不需要解析 package.json，可以引用 yarn 中相关的 api 完成一些操作，笔者暂未做过实验，这里暂不讨论具体用法。</p> <h2 id="lockfile"><a href="#lockfile" class="header-anchor">#</a> Lockfile</h2> <p>yarn.lock 的格式会改成 YAML 格式的子集，并且会把 resolved 原来的绝对路径替换成相对的，这对开发者切换 registry 更加友好。</p> <div class="language- extra-class"><pre class="language-text"><code>wrappy@1:
  version &quot;1.0.2&quot;
  resolved &quot;https://registry.yarnpkg.com/wrappy/-/wrappy-1.0.2.tgz#b5243d8f3ec1aa35f1364605bc0d1036e30ab69f&quot;

wrappy@1:
  version &quot;1.0.2&quot;
  resolved &quot;/wrappy/-/wrappy-1.0.2.tgz#b5243d8f3ec1aa35f1364605bc0d1036e30ab69f&quot;
</code></pre></div><h2 id="flow-typescript"><a href="#flow-typescript" class="header-anchor">#</a> Flow =&gt; TypeScript</h2> <p>Flow 再次惨遭亲爹抛弃，<code>yarn@berry</code> 用 typecript 进行了重写，这会对第三方的维护者更加友好。</p> <h2 id="scripts-underlying-system"><a href="#scripts-underlying-system" class="header-anchor">#</a> Scripts underlying system</h2> <p>不需要在 package.json 的 scripts 中使用类似 cross_env 的命令了，yarn 会默认使用一个轻量级的支持 POSIX 标准的 shell。</p> <h2 id="tar-zip"><a href="#tar-zip" class="header-anchor">#</a> Tar =&gt; Zip</h2> <p>缓存文件的格式从 tar 切换成 zip，zip 的随机访问速度会更快，另外笔者猜测可能是减少下缓存文件大小的体积，毕竟用 tar 打出来的文件是比原来大小要大的，zip 会有 toc 更方便，随机访问 zip 包中的某个文件夹只需要在 toc 中找到存放的文字，直接跳过去即可。</p> <h2 id="better-for-monorepo"><a href="#better-for-monorepo" class="header-anchor">#</a> Better for monorepo</h2> <p>run / add 相关的命令不再不需 cd 到一个个子 package 目录下执行。</p> <h2 id="more"><a href="#more" class="header-anchor">#</a> More</h2> <p>可以戳<a href="https://github.com/yarnpkg/yarn/issues/6953" target="_blank" rel="noopener noreferrer">这里<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>阅读 arcanis 在 issue 区讨论的原文。</p> <h2 id="how-to-try-yarn-berry"><a href="#how-to-try-yarn-berry" class="header-anchor">#</a> How to try yarn@berry</h2> <ol><li>升级 yarn@1.15，这个版本加入了 berry 的 policy</li> <li>打开你的一个项目</li> <li><code>yarn policies set-version nightly</code></li> <li><code>yarn policies set-version berry</code>  🛬</li></ol> <p>如果想恢复到 yarn v1，把项目根目录下生成的 .yarnrc 文件删除即可。
Let's try berry ! 😎</p></div></div> <div class="cute-share">
  Share via
  <div class="cute-share-icon"><i class="iconfont icon-weibo"></i></div><div class="cute-share-icon"><i class="iconfont icon-twitter"></i></div><div class="cute-share-icon"><i class="iconfont icon-wechat"></i></div><div class="cute-share-icon"><i class="iconfont icon-download"></i></div> <div class="van-overlay" style="z-index:1;display:none;"><div class="cute-qrcode-container"><div class="cute-qrcode-inner"><div class="cute-qrcode-title">微信扫一扫，右上角分享</div> <div value="" level="L" background="#fff" foreground="#000"><canvas height="200" width="200" style="width:200px;height:200px;"></canvas></div></div></div></div></div></div> <div class="cute-footer cute-content"><div class="cute-footer-copyright">
    © linrz Themed By <a target="_blank" href="https://github.com/linrz/vuepress-theme-cute">vuepress-theme-cute</a></div> <div class="cute-footer-hills"></div></div></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.f896f474.js" defer></script><script src="/assets/js/3.44ff7866.js" defer></script><script src="/assets/js/1.cd6517b5.js" defer></script><script src="/assets/js/8.000ad2a2.js" defer></script><script src="/assets/js/5.5d81cbfa.js" defer></script>
  </body>
</html>
